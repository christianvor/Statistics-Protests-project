---
title: "Project Report Statistics"
subtitle: "Protests"
author: "Chrsitian Vorhauser"
---

```{r}
#| echo: false
#| message: false
library(car)
library(tidyverse)
library(countrycode)
```

# Describing the data and and what to do

The dataset I chose for my project includes 300 campaigns/projects from all around the world in the time frame of 1960 to 2013. The response variable is the success of the campaign, originally encoded as TRUE or FALSE. But when was a campaign successful? A protest (most often) has a clear objective behind it, be it the dismantlement of the reigning government, or convincing them to not put a law in practice. These are also the only kinds of campaigns present in the data set, and thus a success is granted by the achievement of this goal.

The variables available for each of the campaigns include the participation of the population in percent and the absolute number of participants during the height of it. For some campaigns we have participation rates of less than 0.01% of the population all the way up 128%. This can be the case when people from a different, mainly neighboring, country take part in the campaign and are thus counted towards this number. Since the campaign is only concerning a single country it is possible to achieve values of this magnitude.

The next column is an identifier, which bears no information for us and we thus disregard it. 

Following this, three columns regarding the time of the campaign are listed. The beginning year, the ending year and the year when it was at it's height, meaning the highest number of participants were recorded. As mentioned before we have years ranging from 1960 to 2013, with many taking place either in the time frame 1987-1992, or between 2009-2013. The earlier period can most likely be associated with the fall of the USSR around 1991 where many countries gained their independence. I assume a higher number of campaigns during that time, as the people protested against certain parties, which would have taken control, or be part of the fall itself by campaigning against the USSR government.
The second period could show this increase due to the "Arab Spring" in the early 2010s where many countries in the middle east and northern Africa revolted against the (authoritarian) government. This can also explain the end of many campaigns in 2013 as the "official" end of it was December 2012 (according to Wikipedia). 

To support the theories postulated in the above paragraph, the next column gives us the location of the campaign, which reveals to us that, indeed these two events caused a spike in campaigns during the mentioned time periods. Since quite a number of countries split or got created in the 50+ years our data spans, we need to make sure that, when analyzing it later we treat them correctly regarding continent they are on, since some libraries will not have former countries in their database.

Coming back to a population metric, the next variable is the population in the concerned country during the height of the campaign. This is also the number of citizens used when calculating the participation in terms of population mentioned beforehand. 

Lastly, we columns concerned with, on one hand, if more than 3.5% of the population were engaged in the campaign, and on the other hand, whether the protest was peaceful, or violent. The last one is encoded as "chill" and "PROBLEM" in the original data. For a protest to violent there have to have been physically injured people, it does not matter whether they are on the side of the participants, government/police/military, or the civilian population. 

Coming to the research question I will try to answer: Is violence a significant component to the success of a campaign, or are other factors more influential? Other factors present in the data set that could have an influence are the number of people participating, the share of the population they make up, the duration of the campaign or the location of it.

# describing the data processing and changes i made

To make the data suitable to work with there were some changes to be made. First of all the categorical variables need to be changed to 0/1 encoding. For the singular variables this means:
- A successful campaign is 1, unsuccessful 0
- More than 3.5% involved is 1, less is 0
- A violent campaign is 1, a peaceful one 0

The next step is to change the data type of the variables to numeric when needed. For the participation in percent this means removing the percentage sign ("%") from the string and then converting to numeric. For the population numbers the "," had to be removed, since R uses "." for decimal and nothing for separation of thousands. Afterwards, the conversion to numerics was possible.

Since, I had more than 100 distinct countries in the location column and creating this many dummy variables is not feasible or helps us explain our research question, I decided to assign them each to their respective continent.
This was done with the "countrycodes" package. There were five locations that could not be assigned a continent unambiguously, so I investigated further and found that they were Czechoslovakia and three different versions of Yemen. Czechoslovakia was assigned Europe, and all the Yemens got Asia. 

```{r}
#| echo: false
#| message: false
#| include: false


# laoding and preparing the data
data <- read.csv("protests.csv",header = TRUE,skip = 1)
# chaniging treu false to 0,1
data[which(data$Success. == FALSE),"Success."] <- 0
data[which(data$Success. == TRUE),"Success."] <- 1

data[which(data$greater.than.3.5..of.pop.involved. == FALSE),"greater.than.3.5..of.pop.involved."] <- 0
data[which(data$greater.than.3.5..of.pop.involved. == TRUE),"greater.than.3.5..of.pop.involved."] <- 1

data[which(data$Problem. == "chill"),"Problem."] <- 0
data[which(data$Problem. == "PROBLEM"),"Problem."] <- 1

# bringing the variables into the right format (mostly datatype)
data$participants.as...population <- gsub("%","",data$participants.as...population)
data$participants.as...population <- as.double(data$participants.as...population)

data$MAX.of.participants <- gsub(",","",data$MAX.of.participants)
data$MAX.of.participants <- as.numeric(data$MAX.of.participants)

data$Pop.in.that.year <- gsub(",","",data$Pop.in.that.year)
data$Pop.in.that.year <- as.numeric(data$Pop.in.that.year)

data$Problem. <- as.numeric(data$Problem.)

# grouping countrie into continents

data$continent <- countrycode(data$Location,"country.name","continent")
data$continent[which(data$Location == "Czechoslovakia")] <- "Europe"
data$continent[which(is.na(data$continent))] <- "Asia" # 3 different Yemens
data$continent <- as.factor(data$continent)

# renaming the columns
names <- c("campaign","population_involved","success","max_participants","ID","year_max_involvement","first_year","last_year","location","pop_during_height", "more_than_3.5_involved","violent","continent")
colnames(data) <- names

# creating a "duration" variable instead of 3 variables representing years
data$duration <- data$last_year-data$first_year +1
```


The last step I took, was creating a variable `duration` which stores the length of each campaign in years.

To conclude this first step in processing and transformation I renamed the column of the data set to be easier to use.

Now it is time for more transformations, based on looking at the distribution of the data, but first let's take a look at the scatter plot matrix of the data.

```{r}
#| echo: false
pairs(data[,-c(1,9)])
```

Even in this small format it can be seen that all variables including population metrics have a few data points stretching out far from the rest, while most are crowded together at low values, so I create histograms of them to examine further.
```{r}
par(mfrow=c(3,1))

hist(data$population_involved)
hist(data$max_participants)
hist(data$pop_during_height)
```
After log transformation the data will be more distinguished in a smaller interval, which can be seen in the following histograms. 
```{r}
par(mfrow=c(3,1))
#data$population_involved <- sqrt(data$population_involved)
#data$max_participants <- log2(data$max_participants)
#data$pop_during_height <- log2(data$pop_during_height)
hist(log2(data$population_involved))
hist(log2(data$max_participants))
hist(log2(data$pop_during_height))
```


# a full model and looking at submodels

I choose `success`as my response variabel and violent as the main covariate I want to investigate. In addition I keep population involved, max_participants, year_max_involvement, pop_during_height, the continents and the duration. I also use all interaction terms with the `violent` variable.
The model summary looks as follows.
```{r}
data_mod <- data[,c(2,3,4,6,10,12,13,14)]

logit_full <- glm(success~violent*.,data = data_mod, family = binomial)
summary(logit_full)
```
```{r}
Anova(logit_full)
logit_v2 <- glm(success~violent+.+log2(max_participants)+log2(pop_during_height),data = data_mod, family = binomial)
```

```{r}
anova(logit_full,logit_v2,test="LRT")
```
```{r}
data_mod$residuals <- rstandard(logit_full)
data_mod2 <- data_mod
data_mod <- data_mod[,-9]
data_mod2$continent <-  as.double(data_mod$continent)
data_mod2$pop_during_height <- log2(data_mod$pop_during_height)
data_mod2$max_participants <- log2(data_mod$max_participants)
data_mod2$population_involved <- log2(data_mod$population_involved)
data_mod2[which(data_mod2$population_involved == "-Inf"),"population_involved"] <- -7
data_long <- data_mod2 %>%
  pivot_longer(cols = -residuals, names_to = "variable", values_to = "value")

# Create the plot
ggplot(data_long, aes(x = value, y = residuals)) + 
  geom_point() + 
  geom_smooth() + 
  facet_wrap(~variable, scales = "free") +
  theme_minimal() +
  labs(x = "Name", y = "Value", title = "Multiple Plots for Each Variable")
```
```{r}
logit_v3 <- glm(success~violent+.+log2(pop_during_height)+log2(max_participants)-continent,data=data_mod,family = binomial)
summary(logit_v3)
```
```{r}
anova(logit_full,logit_v3,test="LRT")
logit_v4 <- glm(success~.-violent,data = data_mod,family=binomial)
anova(logit_full,logit_v4,test = "LRT")
```
```{r}
#| warning: false
#Anova(logit_v4)
logit_v5 <- glm(success~duration*.+log2(pop_during_height)+log2(max_participants), data= data_mod,family=binomial)
Anova(logit_v5)
#summary(logit_v5)
```
```{r}
#| warning: false
logit_v6 <- glm(success~duration*(.-continent)-duration:violent-duration:max_participants-duration:pop_during_height-duration:population_involved+log2(pop_during_height)+log2(max_participants),data = data_mod,family = binomial)
anova(logit_v5,logit_v6,type="LRT")
Anova(logit_v6)
```
```{r}
summary(logit_v6)
summary(logit_v5)
```

## cross validation?

```{r}
library(caret)

train_control <- trainControl(method="cv",number = 10)
model <- train(success~duration*(.-continent)-duration:violent-duration:max_participants-duration:pop_during_height-duration:population_involved+log2(pop_during_height)+log2(max_participants), data = data_mod,trControl = train_control, method = "glm", family=binomial())

summary(model)
```


# diagnostics of the model

# conclusions

